<!-- components/subscription-modal.html -->
<!-- Premium Subscription Modal -->
<div id="subscriptionModal" class="modal">
    <div class="modal-content subscription-modal">
        <div class="modal-header">
            <h2><i class="fas fa-crown"></i> Premium Access Required</h2>
            <span class="close" id="close-subscription-modal">&times;</span>
        </div>
        <div class="modal-body">
            <div class="subscription-message">
                <p>To access our college preference list generators and other premium features, you need an active subscription.</p>
            </div>
            
            <div class="subscription-options">
                <div class="subscription-option">
                    <h3><i class="fas fa-credit-card"></i> Pay Subscription Fee</h3>
                    <p>Make a payment using our secure Razorpay link and share the payment screenshot on WhatsApp to get your subscription code.</p>
                    <div class="option-actions">
                        <a href="https://razorpay.me/@nextstepguidance?amount=ZFm4ghdmeB6pF5PK8Ki64w%3D%3D" class="btn payment-btn" target="_blank">
                            <i class="fas fa-external-link-alt"></i> Pay Now
                        </a>
                        <a href="https://wa.me/9420444009?text=Hello!%20I've%20made%20the%20payment%20for%20NextStep%20Premium%20subscription.%20Please%20provide%20my%20subscription%20code." class="btn whatsapp-btn" target="_blank">
                            <i class="fab fa-whatsapp"></i> Contact on WhatsApp
                        </a>
                    </div>
                </div>
                
                <div class="subscription-option">
                    <h3><i class="fas fa-key"></i> Enter Subscription Code</h3>
                    <p>If you already have a subscription code, enter it below to activate your premium access.</p>
                    <div class="subscription-form">
                        <div class="form-group">
                            <input type="text" id="subscription-code" placeholder="Enter your subscription code" class="subscription-input">
                            <div id="subscription-code-error" class="error-message"></div>
                        </div>
                        <button id="activate-subscription" class="btn activate-btn">
                            <i class="fas fa-check-circle"></i> Activate Premium
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add immediate premium check -->
<script>
// Immediate check for premium status when modal is loaded
(function() {
    console.log('Subscription modal loaded - checking premium status');
    
    // Function to hide modal if user is premium
    function checkAndHideForPremium() {
        // Check if either Auth or SubscriptionManager indicates premium status
        const isPremiumViaAuth = window.Auth && window.Auth.isPremium;
        const isPremiumViaManager = window.SubscriptionManager && window.SubscriptionManager.isPremium;
        
        if (isPremiumViaAuth || isPremiumViaManager) {
            console.log('Premium user detected, hiding subscription modal');
            const modal = document.getElementById('subscriptionModal');
            if (modal) {
                modal.style.display = 'none';
            }
            return true;
        }
        return false;
    }
    
    // Try immediately
    if (!checkAndHideForPremium()) {
        // If not successful, try again after waiting for SubscriptionManager
        let attempts = 0;
        const maxAttempts = 10;
        
        function attemptHideModal() {
            attempts++;
            console.log(`Premium check attempt ${attempts}/${maxAttempts}`);
            
            if (checkAndHideForPremium()) {
                console.log('Successfully detected premium status and hidden modal');
                return;
            }
            
            if (attempts < maxAttempts) {
                // Try again soon
                setTimeout(attemptHideModal, 300);
            }
        }
        
        // Start checking
        setTimeout(attemptHideModal, 100);
    }
    
    // Set initial display to none until we confirm status
    // This prevents the modal from flashing briefly
    const modal = document.getElementById('subscriptionModal');
    if (modal) {
        // Store original display value
        const originalDisplay = modal.style.display;
        
        // Hide initially
        modal.style.display = 'none';
        
        // After a short delay, check if we should remain hidden
        setTimeout(() => {
            const isPremiumViaAuth = window.Auth && window.Auth.isPremium;
            const isPremiumViaManager = window.SubscriptionManager && window.SubscriptionManager.isPremium;
            
            // Only restore original display if user is NOT premium
            if (!isPremiumViaAuth && !isPremiumViaManager) {
                modal.style.display = originalDisplay;
            }
        }, 500);
    }
})();
</script>
